<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Test Call to NCT Agent</title>
    <style>
      body { font: 14px/1.4 system-ui, sans-serif; max-width: 640px; margin: 40px auto; }
      button { padding: 10px 16px; margin-right: 8px; }
      #status { margin-top: 10px; }
    </style>
  </head>
  <body>
    <h1>Test Call to NCT Agent</h1>
    <p>Click start and speak. You’ll hear the agent respond in real time.</p>

    <button id="startBtn">Start</button>
    <button id="stopBtn" disabled>Stop</button>
    <div id="status">idle</div>

    <script type="module">
      import { Conversation } from "https://cdn.skypack.dev/@elevenlabs/client";
      const startBtn = document.getElementById('startBtn');
      const stopBtn  = document.getElementById('stopBtn');
      const statusEl = document.getElementById('status');
      const agentId  = "agent_1701k4f8c82pe80943pg035nbxvy"; // hardcoded

      let convo = null;
      const setStatus = (m) => statusEl.textContent = m;

      startBtn.onclick = async () => {
        startBtn.disabled = true;
        setStatus('requesting mic…');
        await navigator.mediaDevices.getUserMedia({ audio: true });
        setStatus('connecting…');

        convo = await Conversation.startSession({
          agentId,
          connectionType: "webrtc",
        });

        convo.on("connected", () => setStatus("connected"));
        convo.on("disconnected", () => setStatus("disconnected"));
        convo.on("error", (e) => setStatus("error: " + (e?.message || e)));

        stopBtn.disabled = false;
      };

      stopBtn.onclick = async () => {
        stopBtn.disabled = true;
        if (convo) { await convo.end(); convo = null; }
        startBtn.disabled = false;
        setStatus('ended');
      };
    </script>
  </body>
</html>
